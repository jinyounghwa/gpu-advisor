# WORLD MODEL 전환 실행 로드맵 (2~4주)

이 문서는 `docs/WORLD_MODEL_THEORY_AND_IMPLEMENTATION.md`의 방향을 실무 실행으로 내리기 위한 로드맵입니다.  
시작일은 **2026-02-22(일)** 기준으로 작성했습니다.

## 0. 목표 정의

현재 상태:
- 데이터 기반 점수 최적화(optimizer) 관성이 남아 있음
- 월드모델(`h/g/f`) + MCTS 구조는 이미 코드에 존재

전환 목표:
1. 의사결정 기준을 단일 점수 최대화에서 계획 품질 중심으로 전환
2. 운영 KPI를 단기 정확도 중심에서 n-step 성과 중심으로 전환
3. 저신뢰 구간에서 보수적 정책이 자동 발동되도록 운영 안전장치 고도화

완료 기준(Definition of Done):
1. 릴리즈 리포트에 계획 KPI가 고정 포함된다.
2. 액션별 사후 성능(`BUY_NOW`, `WAIT_*`, `HOLD`, `SKIP`)이 분리 추적된다.
3. 저신뢰/데이터 이상 시 자동 보수 모드가 발동되고 로그로 검증 가능하다.

## 1. 2주 플랜 (최소 실행안)

## Week 1 (2026-02-23 ~ 2026-03-01): 계측/지표 전환

핵심 목표:
- "잘 맞췄나?"에서 "잘 계획했나?"로 관측 체계를 바꾼다.

실행 항목:
1. 계획 KPI 스키마 정의
- 파일: `docs/PROJECT_PRINCIPLES.md` 또는 신규 KPI 문서에 기준 명시
- 필수 지표:
  - `n_step_return`
  - `trajectory_consistency_error` (계획 대비 실제 오차)
  - `uncertainty_guard_rate` (보수 모드 발동 비율)
  - `wait_action_post_hoc_gain` (`WAIT_*` 선택의 사후 효용)

2. 리포트 출력 확장
- 대상: `docs/reports/latest_release_report.json`, `docs/reports/latest_release_report.md`
- 기존 릴리즈 파이프라인에서 계획 KPI를 함께 저장

3. 운영 로그 보강
- 대상: `backend/agent/gpu_purchase_agent.py`
- 액션 선택 시 다음 기록:
  - MCTS root value
  - 방문수 기반 policy entropy
  - 최종 액션과 안전 게이트 개입 여부

검증 기준:
1. 하루 1회 생성되는 최신 리포트에 계획 KPI 4종이 누락 없이 포함된다.
2. 샘플 20건 이상에서 액션 선택 로그가 구조화(JSON 또는 파싱 가능한 텍스트)로 남는다.

산출물:
1. KPI 정의 문서 1개
2. 확장된 리포트 예시 1개 이상
3. 로그 샘플 캡처 또는 경로 정리

## Week 2 (2026-03-02 ~ 2026-03-08): 운영 정책 전환

핵심 목표:
- 불확실성이 높은 구간에서 자동 보수 정책이 작동하도록 만든다.

실행 항목:
1. 신뢰도 구간 정책표 정의
- High confidence: 계획 결과 적극 반영
- Mid confidence: 계획 + 휴리스틱 혼합
- Low confidence: `WAIT_SHORT`/`HOLD` 중심 보수 정책

2. 게이트 규칙 구현/조정
- 대상: `backend/agent/gpu_purchase_agent.py`, 안전 메커니즘 관련 모듈
- 입력 신호:
  - 예측 엔트로피
  - 데이터 커버리지/결측 지표(`docs/reports/latest_data_status.json`)
  - reward 불확실성(가능하다면 logvar 기반)

3. 회귀 테스트 추가
- 저신뢰 시 과도한 `BUY_NOW` 억제 여부 검증
- 데이터 공백일에서 보수 정책 강제 여부 검증

검증 기준:
1. 저신뢰 케이스 테스트에서 보수 정책 발동률 목표치(예: 80%+) 달성
2. 최근 7일 리포트 기준, 데이터 이상일에 공격적 액션 급증 현상이 없어야 함

산출물:
1. 운영 정책표 문서 1개
2. 테스트 케이스/결과 1세트
3. 정책 반영된 릴리즈 리포트

## 2. 4주 플랜 (권장 확장안)

2주 플랜 이후, 성능과 안정성을 위해 2주를 추가합니다.

## Week 3 (2026-03-09 ~ 2026-03-15): 모델-데이터 정합성 강화

핵심 목표:
- 월드모델 품질 저하의 주원인인 데이터 리스크를 구조적으로 줄인다.

실행 항목:
1. 데이터 품질 게이트 세분화
- 누락률, 이상치율, 피처 드리프트 경고 임계치 정의

2. 실패 사례 리플레이셋 구축
- 잘못된 액션이 나온 날짜/상황을 리플레이 데이터셋으로 분리 관리
- 회귀 검증 시 필수 통과 세트로 사용

3. 체크포인트 호환성 자동 검사 강화
- `input_dim`, `latent_dim`, `action_dim` 불일치 사전 차단

검증 기준:
1. 릴리즈 전 게이트에서 데이터/차원 불일치 이슈가 사전 차단된다.
2. 리플레이셋 기준 회귀 실패율이 이전 대비 감소한다.

산출물:
1. 데이터 게이트 기준표 1개
2. 리플레이셋 목록 및 사용 절차 문서 1개
3. 릴리즈 체크 로그

## Week 4 (2026-03-16 ~ 2026-03-22): 의사결정 운영화

핵심 목표:
- 계획 기반 의사결정을 팀의 표준 운영 프로세스로 고정한다.

실행 항목:
1. 주간 리뷰 템플릿 교체
- 기존: 예측 정확도 중심
- 변경: 계획 KPI + 액션별 사후 성과 + 안전게이트 발동 분석

2. 액션 정책 캘리브레이션
- `BUY_NOW` 임계치, `WAIT_*` 전환 조건 재조정
- 과매수/과대기 균형 최적화

3. 문서 체계 고정
- 본 문서 + 이론 문서 + 안전 문서 연결 링크 정리
- 신규 온보딩 시 필수 학습 순서 정의

검증 기준:
1. 팀 리뷰에서 계획 KPI가 기본 대시보드로 사용된다.
2. 2주 연속 운영에서 치명적 정책 역전(저신뢰 구간 공격적 매수 등) 0건

산출물:
1. 주간 리뷰 템플릿
2. 캘리브레이션 결과표
3. 온보딩 학습 순서 문서 업데이트

## 3. 역할 분담 가이드

1. Data/Crawler 담당
- 데이터 커버리지, 결측/이상치, 드리프트 감시

2. Model/Planning 담당
- `h/g/f` 성능, MCTS 파라미터, 리플레이셋 회귀

3. Agent/Backend 담당
- 정책 게이트, 추론 로그, 릴리즈 체크 자동화

4. Product/Ops 담당
- KPI 해석, 액션 사후 성과 분석, 정책 임계치 의사결정

## 4. 리스크와 대응

1. 리스크: 모델 복잡도 증가로 디버깅 난이도 상승
- 대응: 로그 표준화 + 리플레이셋 기반 재현성 확보

2. 리스크: 데이터 품질 부족으로 계획 성능 불안정
- 대응: 데이터 게이트를 릴리즈 필수 조건으로 강제

3. 리스크: 보수 정책 과도 적용으로 기회 손실
- 대응: `uncertainty_guard_rate`와 사후 성과를 같이 최적화

## 5. 바로 실행할 첫 3가지

1. 2026-02-23에 계획 KPI 4종 스키마를 확정한다.
2. 2026-02-24까지 릴리즈 리포트에 계획 KPI를 추가한다.
3. 2026-02-26까지 저신뢰 자동 보수 게이트의 초안 규칙을 배포한다.

---

참조 문서:
- `docs/WORLD_MODEL_THEORY_AND_IMPLEMENTATION.md`
- `docs/SAFETY_MECHANISMS.md`
- `docs/PROJECT_PRINCIPLES.md`
